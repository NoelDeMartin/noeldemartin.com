---
id: implementing-a-recipes-manager-using-solid-15
blueprint: comment
title: 'Implementing a Recipes Manager using Solid - 15'
task: 'entry::implementing-a-recipes-manager-using-solid'
publication_date: '2022-03-21 19:26:14'
---

I'm not done with the app yet, but last week I worked on something that I thought would be interesting as a stand-alone update. So, today's entry will be 100% technical :).

One feature I hadn't implemented yet was image uploading. If you check the list of things left to do from last time, you'll notice this wasn't there. And that's because I didn't intended to implement it for the initial release. However, after going through the onboarding, I realized this is actually very important. So far, I had just been grabbing recipes and images from the Web, but when I actually tried to create my own recipes, the inability of uploading images was too crippling. So I just went ahead and started implementing it. After all, I've already implemented image uploads in other apps many times, how hard could it be to do it in Solid? (said the ingenuous fool).

Turns out, it's not that easy. I was already aware that images cannot be inserted in the DOM like you would any normal image. If you write `<img src="https://my-pod.com/recipes/ramen.jpg">`, this will probably fail to render the image. That happens because the image will be private, and the POD can't return its contents without proper authentication. The solution is to fetch the image using an authenticated fetch and inject the image contents dynamically with Javascript. [That's actually what Inrupt's React SDK is doing](https://github.com/inrupt/solid-ui-react/blob/main/src/components/image/index.tsx). And that works, but I faced an additional issue. My app is offline-first! If I really mean it, you should be able to create new recipes offline (including images, of course). So that alone won't cut it.

After some tinkering, I came up with a solution that whilst not being perfect is good enough for the first version. Basically, I am storing images in IndexedDB. Something nice is that you can actually store Blobs in IndexedDB, so I didn't have to bother with serialization woes. When the user goes back online, I'll upload the images to the server and remove them from IndexedDB. This works better than I expected, and even though [it complicated the image component a bit](https://github.com/NoelDeMartin/umai/blob/c9f26702ba4f01b91003df51caa1da8e94fa3fcc/src/components/recipe/RecipeImage.vue), it's worth it.

But there was still another issue. Browsers are pretty good at caching images; if you go offline, it's very likely that you can see the images you've encountered online without doing anything special. This is because images usually come with [some special headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control) and get cached for a while. However, Solid servers don't seem to do that at the moment (I have to investigate why, but I don't think I'll be able to fix that anytime soon). So it's up to my app to cache everything. As far as I understand, that's not something Inrupt's SDK is having into account, so images are downloaded each time they are appear on screen which ain't nice (I could be mistaken though, I haven't used the library, I've only browsed the source code from time to time). What I ended up doing to work around this issue, is using the [Cache API](https://developer.mozilla.org/en-US/docs/Web/API/Cache) to store images. The good part is that since they are treated as cache, the browser can remove them whenever it needs some storage. The bad part is that it doesn't know anything about caching headers, so I have to handle all that manually. Which I'm not doing yet, so images are essentially cached forever. Which in turn causes a related issue: when images are updated in the POD, my app won't notice and it'll continue using the old version. I can probably fix that by doing a HEAD request and compare ETags or something, but I still haven't done any of that and this is where I'll leave it for the first version.

There is also something else that made me avoid this feature in the first place. And that is treating the images. In a typical application, you upload the raw image file and the server takes care of resizing it and generating thumbnails if necessary. But given that I'm doing a "pure" Solid App (one without a server component), I can't do that. Initially, I looked at the [filepond](https://pqina.nl/filepond/) library, which is pretty nice but felt too heavy for my use-case. After digging a little bit more, I ended up using a smaller library called [image-blob-reduce](https://github.com/nodeca/image-blob-reduce); which ain't as fancy but gets the job done and has a much smaller footprint. I also decided not to generate thumbnails for now, but I think that should be fine for the initial release.

And that's it for today's update! I already started working on the sharing functionality and I think it's looking good, I want it to be useful for both Solid and non-Solid users alike. So it may end up being one of the most important features in the app. But more about that in an upcoming update.
